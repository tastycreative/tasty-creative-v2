version: 1
frontend:
  phases:
    preBuild:
      commands:
        - npm ci
        - npx prisma generate
    build:
      commands:
        - npm run build
  artifacts:
    baseDirectory: .next
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
      - .next/cache/**/*

# CRITICAL: Configure environment variables for Lambda runtime (SSR)
# AWS Amplify needs this to pass environment variables to Next.js Lambda functions
compute:
  # List all environment variables that should be available at runtime
  # These must also be set in the Amplify Console under "Environment variables"
  environment:
    # NextAuth (REQUIRED for authentication)
    - NEXTAUTH_SECRET
    - NEXTAUTH_URL

    # Google OAuth (REQUIRED)
    - AUTH_GOOGLE_ID
    - AUTH_GOOGLE_SECRET

    # Database (REQUIRED)
    - DATABASE_URL

    # Optional: Feature-specific environment variables
    - ABLY_API_KEY
    - OPENAI_API_KEY
    - SUPABASE_URL
    - SUPABASE_ANON_KEY
    - REDIS_URL

    # Optional: AWS S3 (if using S3 for storage)
    - AWS_REGION
    - AWS_ACCESS_KEY_ID
    - AWS_SECRET_ACCESS_KEY
    - AWS_S3_BUCKET
